<!DOCTYPE html>

<html lang="<%= lang %>">

<head>
    <title><%= title %></title>
    <link rel="icon" type="image/x-icon" href="/images/header/logo32.ico"/>

    <script type="text/javascript" src="/scripts/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="/scripts/select2.min.js"></script>

    <link rel="stylesheet" href="/style/select2.min.css"/>
    <link rel="stylesheet" href="/style/w3.css"/>
    <link rel="stylesheet" href="/style/header.css"/>
    <link rel="stylesheet" href="/style/footer.css"/>

    <meta charset="utf-8"/>
    <meta name="description" content="Aktuelles Wetter in Straubing, bereitgestellt durch die Wetterstation des Johannes-Turmair-Gymnasiums Straubing"> <!-- TODO: Replace with a dynamic filled value -->
    <meta name="keywords" content="JTG, Wetterdaten">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="googlebot-image" content="noindex" />
    <meta name="MSNBot-Media" content="noindex" />

    <script>
        $(document).ready(function(){
            $("#language").select2({
                templateSelection: formatState,
                templateResult: formatState
            });

            $('#language').on('select2:select', function (e) {
                $.ajax({
                    url: "/api/lang",
                    type: "POST",
                    data: { "lng": $("#language").val() },
                    dataType:"json",
                    success: function () {location.reload();} //TODO Finish this
                });
            });
        });

        function formatState (state) {
            if (!state.id) { return state.text; }
            var $state = $(
                '<span ><img sytle="display: inline-block;" src="/images/' + state.element.value.toLowerCase() + '.png" /> ' + '<p>' + state.text + '</p>' + '</span>'
            );
            return $state;
        }
    </script>
</head>

<div class="navbar navbar-default navbar-static-top" role="navigation">
    <div class="navbar-inner">
        <a class="logo" href="/">
            <figure>
                <img src="/images/header/logo3.svg" height="36px" alt="<%=t('header.logo-alt')%>" id="logoimage"/>
                <figcaption class="logocaption">
                    <%=t('header.logo-span')%>
                </figcaption>
            </figure>
        </a>

        <figure class="weatherSmall">
            <img src="/images/weather/svg/cloud.webp" alt="<%=t('header.weather.alt_cloudy')%>" height="50px" id="weatherimage">
            <figcaption class="logocaption alwaysShow">
                27Â°C
            </figcaption>
        </figure>

        <div class="spacer"></div>

        <div class="menu-btn">
            <div class="btn-line"></div>
            <div class="btn-line" style="transition-duration: 0.25s;"></div>
            <div class="btn-line"></div>
        </div>
        <div class="menu w3-sidebar w3-bar-block w3-card w3-animate-right" id="rightMenu">
            <a href="/login" class="w3-bar-item w3-button"><%=t('header.nav.login')%></a>
            <a href="/about" class="w3-bar-item w3-button"><%=t('header.nav.about')%></a>
            <a href="/link3" class="w3-bar-item w3-button"><%=t('header.nav.link3')%></a>
        </div>
        <script>
            // Select dom items
            const menuBtn =
                document.querySelector(".menu-btn");

            const menu =
                document.querySelector(".menu")


            // Set the initial state of the menu
            let showMenu = false;

            menuBtn.addEventListener("click", toggleMenu);

            function toggleMenu() {
                if (!showMenu) {
                    menuBtn.classList.add("close");
                    menu.classList.add("show");

                    // Reset the menu state
                    showMenu = true;
                } else {
                    menuBtn.classList.remove("close");
                    menu.classList.remove("show")

                    // Reset the menu state
                    showMenu = false;
                }
            }
        </script>
        <ul class="navbar-right" >
            <li>
                <select id="language">
                    <script type="text/javascript">
                        $.ajax({
                            url: "/api/lang-available",
                            type: "GET",
                            dataType:"json",
                            success: function(result) {
                                const langs = new Map(Object.entries(result));
                                langs.forEach(function (v, k) {
                                    document.getElementById('language').insertAdjacentHTML("beforeend",`<option value=${k}>${v}</option>`);
                                });
                            }
                        });
                    </script>
                </select>
            </li>
            <li><a href="/login" class="button-top-right"><%=t('header.nav.login')%></a></li>
            <li><a href="/about" class="button-top-right"><%=t('header.nav.about')%></a></li>
            <li><a href="/link3" class="button-top-right"><%=t('header.nav.link3')%></a></li>
        </ul>
    </div>
</div>

<div class="container" style="min-height: calc(100vh - 178.5px);">
</html>